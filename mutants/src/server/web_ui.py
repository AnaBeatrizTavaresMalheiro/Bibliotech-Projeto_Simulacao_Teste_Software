from fastapi import APIRouter, Request, Form
from fastapi.responses import RedirectResponse
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates
from starlette.status import HTTP_303_SEE_OTHER

from src.db.conexao import obter_sessao
from src.db.modelos import Usuario, Livro, Emprestimo
from src.configuracoes.excecoes import ErroDeRegraNegocio, ErroNaoEncontrado

from sqlalchemy import select, text

from fastapi.responses import HTMLResponse

import json
from pathlib import Path
from datetime import datetime
from src.db.modelos import Usuario, Livro, Emprestimo

from fastapi import Depends
from sqlalchemy.orm import Session  # se estiver usando SQLAlchemy puro
from src.db.conexao import obter_sessao

# templates & static
# templates = Jinja2Templates(directory="src/server/templates")
# mount static - o main.py já incluiu o router; o app principal monta a pasta estática no main

ROOT_DIR = Path(__file__).resolve().parents[1]
TEMPLATES_DIR = ROOT_DIR / "server" / "templates"

templates = Jinja2Templates(directory=str(TEMPLATES_DIR))


router = APIRouter(prefix="/web")
from inspect import signature as _mutmut_signature
from typing import Annotated
from typing import Callable
from typing import ClassVar


MutantDict = Annotated[dict[str, Callable], "Mutant"]


def _mutmut_trampoline(orig, mutants, call_args, call_kwargs, self_arg = None):
    """Forward call to original or mutated function, depending on the environment"""
    import os
    mutant_under_test = os.environ['MUTANT_UNDER_TEST']
    if mutant_under_test == 'fail':
        from mutmut.__main__ import MutmutProgrammaticFailException
        raise MutmutProgrammaticFailException('Failed programmatically')      
    elif mutant_under_test == 'stats':
        from mutmut.__main__ import record_trampoline_hit
        record_trampoline_hit(orig.__module__ + '.' + orig.__name__)
        result = orig(*call_args, **call_kwargs)
        return result
    prefix = orig.__module__ + '.' + orig.__name__ + '__mutmut_'
    if not mutant_under_test.startswith(prefix):
        result = orig(*call_args, **call_kwargs)
        return result
    mutant_name = mutant_under_test.rpartition('.')[-1]
    if self_arg:
        # call to a class method where self is not bound
        result = mutants[mutant_name](self_arg, *call_args, **call_kwargs)
    else:
        result = mutants[mutant_name](*call_args, **call_kwargs)
    return result

    
# --- Home web
@router.get("/", include_in_schema=False)
def web_index(request: Request):
    return templates.TemplateResponse("index.html", {"request": request})

# ------------------ USUÁRIOS ------------------
# @router.get("/usuarios")
# def web_list_usuarios(request: Request, q: str | None = None, sessao: Session = Depends(obter_sessao)):
#     usuarios = sessao.exec(select(Usuario)).all() if hasattr(sessao, 'exec') else sessao.query(Usuario).all()
#     if q:
#         usuarios = [u for u in usuarios if q.lower() in u.nome.lower()]
#     return templates.TemplateResponse("usuarios_list.html", {"request": request, "usuarios": usuarios})

from sqlalchemy.orm import selectinload

@router.get("/usuarios")
def web_list_usuarios(request: Request, q: str | None = None, sessao: Session = Depends(obter_sessao)):
    resultado = sessao.exec(select(Usuario)) if hasattr(sessao, 'exec') else sessao.query(Usuario)
    usuarios = [r[0] if not isinstance(r, Usuario) else r for r in resultado]

    if q:
        usuarios = [u for u in usuarios if q.lower() in u.nome.lower()]

    usuarios_dict = [
        {
            "id": u.id,
            "nome": u.nome,
            "email": u.email,
            "qtd_emprestimo": u.qtd_emprestimo,
            "possui_multa_aberta": u.possui_multa_aberta,
        }
        for u in usuarios
    ]

    return templates.TemplateResponse(
        "usuarios_list.html",
        {"request": request, "usuarios": usuarios_dict},
    )



@router.get("/usuarios/novo")
def web_usuario_novo(request: Request):
    return templates.TemplateResponse("usuario_form.html", {"request": request, "usuario": None})

@router.post("/usuarios/novo")
async def web_usuario_criar(request: Request):
    form = await request.form()
    nome = form.get("nome", "").strip()
    email = form.get("email", "").strip()
    sessao = next(obter_sessao())
    try:
        # validação simples
        if not nome:
            raise ErroDeRegraNegocio("Nome obrigatório")
        # duplicidade
        existente = sessao.exec(select(Usuario).where(Usuario.email == email)).first() if hasattr(sessao, 'exec') else sessao.query(Usuario).filter_by(email=email).first()
        if existente:
            raise ErroDeRegraNegocio("E-mail já cadastrado")
        usuario = Usuario(nome=nome, email=email)
        sessao.add(usuario)
        sessao.commit()
        sessao.refresh(usuario)
        return RedirectResponse(url="/web/usuarios", status_code=HTTP_303_SEE_OTHER)
    except ErroDeRegraNegocio as e:
        return templates.TemplateResponse("usuario_form.html", {"request": request, "usuario": {"nome": nome, "email": email}, "erro": str(e)})

@router.get("/usuarios/{usuario_id}/editar")
def web_usuario_editar(request: Request, usuario_id: int):
    sessao = next(obter_sessao())
    usuario = sessao.get(Usuario, usuario_id)
    if not usuario:
        return templates.TemplateResponse("404.html", {"request": request, "mensagem": "Usuário não encontrado"}, status_code=404)
    return templates.TemplateResponse("usuario_form.html", {"request": request, "usuario": usuario})

@router.post("/usuarios/{usuario_id}/editar")
async def web_usuario_update(request: Request, usuario_id: int):
    form = await request.form()
    nome = form.get("nome", "").strip()
    email = form.get("email", "").strip()
    sessao = next(obter_sessao())
    usuario = sessao.get(Usuario, usuario_id)
    if not usuario:
        return templates.TemplateResponse("404.html", {"request": request, "mensagem": "Usuário não encontrado"}, status_code=404)
    try:
        if not nome:
            raise ErroDeRegraNegocio("Nome obrigatório")
        usuario.nome = nome
        usuario.email = email
        sessao.add(usuario)
        sessao.commit()
        sessao.refresh(usuario)
        return RedirectResponse(url="/web/usuarios", status_code=HTTP_303_SEE_OTHER)
    except ErroDeRegraNegocio as e:
        return templates.TemplateResponse("usuario_form.html", {"request": request, "usuario": usuario, "erro": str(e)})

@router.post("/usuarios/{usuario_id}/deletar")
def web_usuario_deletar(request: Request, usuario_id: int):
    sessao = next(obter_sessao())
    usuario = sessao.get(Usuario, usuario_id)
    if not usuario:
        return templates.TemplateResponse("404.html", {"request": request, "mensagem": "Usuário não encontrado"}, status_code=404)
    # regra: não deletar se tiver emprestimos ativos
    emprestimo_ativo = sessao.exec(select(Emprestimo).where(Emprestimo.usuario_id == usuario_id, Emprestimo.data_devolucao_real.is_(None))).first() if hasattr(sessao, 'exec') else None
    if emprestimo_ativo:
        return templates.TemplateResponse("usuarios_list.html", {"request": request, "usuarios": sessao.exec(select(Usuario)).all() if hasattr(sessao, 'exec') else sessao.query(Usuario).all(), "erro": "Usuário possui empréstimo ativo"})
    sessao.delete(usuario)
    sessao.commit()
    return RedirectResponse(url="/web/usuarios", status_code=HTTP_303_SEE_OTHER)

# ------------------ LIVROS ------------------
@router.get("/livros")
# def web_list_livros(request: Request, q: str | None = None, sessao: Session = Depends(obter_sessao)):
#     livros = sessao.exec(select(Livro)).all() if hasattr(sessao, 'exec') else sessao.query(Livro).all()
#     if q:
#         livros = [l for l in livros if q.lower() in l.titulo.lower()]
#     return templates.TemplateResponse("livros_list.html", {"request": request, "livros": livros, "q": q})

@router.get("/livros")
def web_list_livros(request: Request, q: str | None = None, sessao: Session = Depends(obter_sessao)):
    resultado = sessao.exec(select(Livro)) if hasattr(sessao, 'exec') else sessao.query(Livro)
    livros = [r[0] if not isinstance(r, Livro) else r for r in resultado]

    if q:
        livros = [l for l in livros if q.lower() in l.titulo.lower()]

    livros_dict = [
        {
            "id": l.id,
            "titulo": l.titulo,
            "isbn": l.isbn,
            "disponivel": l.disponivel,
        }
        for l in livros
    ]

    return templates.TemplateResponse(
        "livros_list.html",
        {"request": request, "livros": livros_dict},
    )


@router.get("/livros/novo")
def web_livro_novo(request: Request):
    return templates.TemplateResponse("livro_form.html", {"request": request, "livro": None})

@router.post("/livros/novo")
async def web_livro_criar(request: Request):
    form = await request.form()
    titulo = form.get("titulo", "").strip()
    isbn = form.get("isbn", "").strip()
    sessao = next(obter_sessao())
    try:
        if not titulo or not isbn:
            raise ErroDeRegraNegocio("Título e ISBN obrigatórios")
        existente = sessao.exec(select(Livro).where(Livro.isbn == isbn)).first() if hasattr(sessao, 'exec') else sessao.query(Livro).filter_by(isbn=isbn).first()
        if existente:
            raise ErroDeRegraNegocio("ISBN já cadastrado")
        livro = Livro(titulo=titulo, isbn=isbn, disponivel=True)
        sessao.add(livro)
        sessao.commit()
        sessao.refresh(livro)
        return RedirectResponse(url="/web/livros", status_code=HTTP_303_SEE_OTHER)
    except ErroDeRegraNegocio as e:
        return templates.TemplateResponse("livro_form.html", {"request": request, "livro": {"titulo": titulo, "isbn": isbn}, "erro": str(e)})

@router.post("/livros/{livro_id}/deletar")
def web_livro_deletar(request: Request, livro_id: int):
    sessao = next(obter_sessao())
    livro = sessao.get(Livro, livro_id)
    if not livro:
        return templates.TemplateResponse("404.html", {"request": request, "mensagem": "Livro não encontrado"}, status_code=404)
    # regra: não deletar se existir empréstimo ativo
    emprestimo_ativo = sessao.exec(select(Emprestimo).where(Emprestimo.livro_id == livro_id, Emprestimo.data_devolucao_real.is_(None))).first() if hasattr(sessao, 'exec') else None
    if emprestimo_ativo:
        return templates.TemplateResponse("livros_list.html", {"request": request, "livros": sessao.exec(select(Livro)).all() if hasattr(sessao, 'exec') else sessao.query(Livro).all(), "erro": "Livro possui empréstimo ativo"})
    sessao.delete(livro)
    sessao.commit()
    return RedirectResponse(url="/web/livros", status_code=HTTP_303_SEE_OTHER)

# ------------------ EMPRÉSTIMOS ------------------
# @router.get("/emprestimos")
# def web_list_emprestimos(request: Request, sessao: Session = Depends(obter_sessao)):
#     emprestimos = sessao.exec(select(Emprestimo)).all() if hasattr(sessao, 'exec') else sessao.query(Emprestimo).all()
#     return templates.TemplateResponse("emprestimos_list.html", {"request": request, "emprestimos": emprestimos})


@router.get("/emprestimos")
def web_list_emprestimos(request: Request, sessao: Session = Depends(obter_sessao)):
    resultado = sessao.exec(
        select(Emprestimo)
        .options(selectinload(Emprestimo.usuario), selectinload(Emprestimo.livro))
    ) if hasattr(sessao, 'exec') else sessao.query(Emprestimo)
    emprestimos = [r[0] if not isinstance(r, Emprestimo) else r for r in resultado]

    emprestimos_dict = [
        {
            "id": e.id,
            "usuario": e.usuario.nome if e.usuario else "—",
            "livro": e.livro.titulo if e.livro else "—",
            "data_emprestimo": e.data_emprestimo.strftime("%d/%m/%Y") if e.data_emprestimo else "",
            "data_devolucao_prevista": e.data_devolucao_prevista.strftime("%d/%m/%Y") if e.data_devolucao_prevista else "",
            "data_devolucao_real": e.data_devolucao_real.strftime("%d/%m/%Y") if e.data_devolucao_real else "",
            "dias_atraso": e.dias_atraso,
            "valor_multa": f"R$ {e.valor_multa:.2f}",
        }
        for e in emprestimos
    ]

    return templates.TemplateResponse(
        "emprestimos_list.html",
        {"request": request, "emprestimos": emprestimos_dict},
    )


@router.get("/emprestimos/novo")
def web_emprestimo_novo(request: Request):
    sessao = next(obter_sessao())
    usuarios = sessao.exec(select(Usuario)).all() if hasattr(sessao, 'exec') else sessao.query(Usuario).all()
    livros = sessao.exec(select(Livro).where(Livro.disponivel == True)).all() if hasattr(sessao, 'exec') else sessao.query(Livro).filter_by(disponivel=True).all()
    return templates.TemplateResponse("emprestimo_form.html", {"request": request, "usuarios": usuarios, "livros": livros})

@router.post("/emprestimos/novo")
async def web_emprestimo_criar(request: Request):
    form = await request.form()
    usuario_id = int(form.get("usuario_id"))
    livro_id = int(form.get("livro_id"))
    sessao = next(obter_sessao())
    try:
        usuario = sessao.get(Usuario, usuario_id)
        livro = sessao.get(Livro, livro_id)
        if not usuario or not livro:
            raise ErroNaoEncontrado("Usuário ou livro não encontrado")
        if usuario.possui_multa_aberta:
            raise ErroDeRegraNegocio("Usuário com multa aberta")
        if not livro.disponivel:
            raise ErroDeRegraNegocio("Livro indisponível")
        # cria emprestimo
        from datetime import date, timedelta
        emprestimo = Emprestimo(livro_id=livro_id, usuario_id=usuario_id, data_emprestimo=date.today(), data_devolucao_prevista=date.today() + timedelta(days=7))
        sessao.add(emprestimo)
        livro.disponivel = False
        usuario.qtd_emprestimo += 1
        sessao.add(livro)
        sessao.add(usuario)
        sessao.commit()
        sessao.refresh(emprestimo)
        return RedirectResponse(url="/web/emprestimos", status_code=HTTP_303_SEE_OTHER)
    except (ErroDeRegraNegocio, ErroNaoEncontrado) as e:
        usuarios = sessao.exec(select(Usuario)).all() if hasattr(sessao, 'exec') else sessao.query(Usuario).all()
        livros = sessao.exec(select(Livro).where(Livro.disponivel == True)).all() if hasattr(sessao, 'exec') else sessao.query(Livro).filter_by(disponivel=True).all()
        return templates.TemplateResponse("emprestimo_form.html", {"request": request, "usuarios": usuarios, "livros": livros, "erro": str(e)})

@router.post("/emprestimos/{emprestimo_id}/devolver")
def web_emprestimo_devolver(request: Request, emprestimo_id: int):
    sessao = next(obter_sessao())
    emprestimo = sessao.get(Emprestimo, emprestimo_id)
    if not emprestimo:
        return templates.TemplateResponse("404.html", {"request": request, "mensagem": "Empréstimo não encontrado"}, status_code=404)
    if emprestimo.data_devolucao_real:
        return templates.TemplateResponse("emprestimos_list.html", {"request": request, "emprestimos": sessao.exec(select(Emprestimo)).all() if hasattr(sessao, 'exec') else sessao.query(Emprestimo).all(), "erro": "Empréstimo já devolvido"})
    from datetime import date
    emprestimo.data_devolucao_real = date.today()
    # calcula dias atraso e multa (exemplo)
    if emprestimo.data_devolucao_prevista and emprestimo.data_devolucao_real > emprestimo.data_devolucao_prevista:
        dias = (emprestimo.data_devolucao_real - emprestimo.data_devolucao_prevista).days
        emprestimo.dias_atraso = dias
        emprestimo.valor_multa = (dias * 1.5)  # usa config se desejar
    livro = sessao.get(Livro, emprestimo.livro_id)
    usuario = sessao.get(Usuario, emprestimo.usuario_id)
    livro.disponivel = True
    usuario.qtd_emprestimo = max(0, usuario.qtd_emprestimo - 1)
    if emprestimo.valor_multa > 0:
        usuario.possui_multa_aberta = True
    sessao.add(livro)
    sessao.add(usuario)
    sessao.add(emprestimo)
    sessao.commit()
    return RedirectResponse(url="/web/emprestimos", status_code=HTTP_303_SEE_OTHER)




############## carregando dados de /data

def x_carregar_dados_json__mutmut_orig(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_1(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = None

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_2(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent * "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_3(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(None).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_4(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "XXdataXX"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_5(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "DATA"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_6(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = None
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_7(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR * "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_8(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "XXusuarios.jsonXX"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_9(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "USUARIOS.JSON"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_10(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(None, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_11(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding=None) as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_12(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_13(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, ) as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_14(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="XXutf-8XX") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_15(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="UTF-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_16(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(None):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_17(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(None, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_18(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, None):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_19(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr('exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_20(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, ):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_21(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'XXexecXX'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_22(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'EXEC'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_23(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = None
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_24(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(None).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_25(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(None)).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_26(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(None).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_27(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email != u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_28(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["XXemailXX"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_29(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["EMAIL"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_30(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) and hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_31(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(None, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_32(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, None):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_33(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr("_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_34(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, ):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_35(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "XX_mappingXX"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_36(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_MAPPING"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_37(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = None  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_38(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[1]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_39(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = None
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_40(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=None).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_41(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(None).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_42(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["XXemailXX"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_43(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["EMAIL"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_44(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_45(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = None
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_46(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=None,
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_47(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=None,
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_48(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=None,
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_49(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=None
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_50(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_51(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_52(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_53(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_54(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["XXnomeXX"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_55(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["NOME"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_56(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["XXemailXX"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_57(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["EMAIL"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_58(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get(None, False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_59(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", None),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_60(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get(False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_61(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", ),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_62(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("XXpossui_multa_abertaXX", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_63(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("POSSUI_MULTA_ABERTA", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_64(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", True),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_65(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get(None, 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_66(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", None)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_67(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get(0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_68(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", )
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_69(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("XXqtd_emprestimoXX", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_70(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("QTD_EMPRESTIMO", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_71(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 1)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_72(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(None)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_73(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = None
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_74(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = None

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_75(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["XX_db_idXX"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_76(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_DB_ID"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_77(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = None
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_78(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR * "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_79(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "XXlivros.jsonXX"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_80(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "LIVROS.JSON"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_81(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(None, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_82(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding=None) as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_83(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_84(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, ) as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_85(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="XXutf-8XX") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_86(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="UTF-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_87(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(None):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_88(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(None, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_89(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, None):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_90(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr('exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_91(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, ):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_92(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'XXexecXX'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_93(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'EXEC'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_94(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = None
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_95(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(None).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_96(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(None)).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_97(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(None).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_98(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn != l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_99(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["XXisbnXX"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_100(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["ISBN"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_101(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) and hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_102(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(None, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_103(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, None):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_104(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr("_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_105(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, ):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_106(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "XX_mappingXX"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_107(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_MAPPING"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_108(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = None
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_109(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[1]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_110(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = None
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_111(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=None).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_112(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(None).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_113(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["XXisbnXX"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_114(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["ISBN"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_115(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_116(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = None
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_117(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=None,
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_118(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=None,
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_119(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=None
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_120(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_121(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_122(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_123(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["XXtituloXX"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_124(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["TITULO"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_125(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["XXisbnXX"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_126(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["ISBN"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_127(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get(None, True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_128(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", None)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_129(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get(True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_130(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", )
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_131(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("XXdisponivelXX", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_132(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("DISPONIVEL", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_133(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", False)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_134(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(None)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_135(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = None
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_136(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = None

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_137(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["XX_db_idXX"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_138(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_DB_ID"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_139(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = None
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_140(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR * "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_141(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "XXemprestimo.jsonXX"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_142(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "EMPRESTIMO.JSON"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_143(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(None, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_144(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding=None) as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_145(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_146(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, ) as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_147(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="XXutf-8XX") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_148(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="UTF-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_149(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(None):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_150(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = None
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_151(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get(None)
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_152(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("XXusuario_idXX")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_153(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("USUARIO_ID")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_154(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = None
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_155(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get(None)
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_156(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("XXlivro_idXX")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_157(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("LIVRO_ID")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_158(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(None, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_159(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, None):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_160(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr('exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_161(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, ):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_162(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'XXexecXX'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_163(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'EXEC'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_164(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = None
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_165(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(None).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_166(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(None)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_167(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(None).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_168(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id != usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_169(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = None
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_170(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(None).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_171(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(None)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_172(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(None).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_173(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id != livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_174(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) and hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_175(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(None, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_176(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, None):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_177(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr("_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_178(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, ):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_179(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "XX_mappingXX"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_180(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_MAPPING"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_181(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = None
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_182(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[1]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_183(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) and hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_184(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(None, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_185(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, None):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_186(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr("_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_187(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, ):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_188(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "XX_mappingXX"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_189(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_MAPPING"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_190(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = None
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_191(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[1]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_192(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = None
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_193(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=None).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_194(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(None).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_195(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = None
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_196(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=None).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_197(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(None).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_198(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario or livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_199(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = None
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_200(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(None).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_201(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["XXdata_emprestimoXX"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_202(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["DATA_EMPRESTIMO"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_203(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = None
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_204(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(None).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_205(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["XXdata_devolucao_previstaXX"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_206(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["DATA_DEVOLUCAO_PREVISTA"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_207(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_208(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(None).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_209(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["XXdata_devolucao_realXX"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_210(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["DATA_DEVOLUCAO_REAL"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_211(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get(None) else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_212(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("XXdata_devolucao_realXX") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_213(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("DATA_DEVOLUCAO_REAL") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_214(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(None, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_215(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, None):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_216(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr('exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_217(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, ):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_218(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'XXexecXX'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_219(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'EXEC'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_220(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = None
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_221(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            None
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_222(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                None,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_223(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                None,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_224(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                None
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_225(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_226(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_227(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_228(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(None).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_229(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id != usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_230(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id != livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_231(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo != data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_232(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) and hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_233(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(None, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_234(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, None):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_235(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr("_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_236(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, ):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_237(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "XX_mappingXX"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_238(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_MAPPING"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_239(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = None
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_240(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[1]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_241(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = None

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_242(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=None,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_243(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=None,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_244(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=None
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_245(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_246(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_247(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_248(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(None).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_249(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_250(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = None
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_251(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=None,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_252(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=None,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_253(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=None,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_254(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=None,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_255(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=None,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_256(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=None,
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_257(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=None
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_258(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_259(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_260(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_261(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_262(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_263(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_264(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_265(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get(None, 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_266(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", None),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_267(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get(0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_268(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", ),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_269(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("XXdias_atrasoXX", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_270(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("DIAS_ATRASO", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_271(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 1),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_272(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get(None, 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_273(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", None)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_274(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get(0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_275(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", )
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_276(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("XXvalor_multaXX", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_277(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("VALOR_MULTA", 0)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_278(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 1)
                        )
                        sessao.add(emprestimo)
        sessao.commit()




############## carregando dados de /data

def x_carregar_dados_json__mutmut_279(sessao):
    """
    Carrega dados dos arquivos JSON da pasta /data para o banco.
    Funciona com SQLAlchemy e SQLModel.
    """
    from pathlib import Path
    import json
    from datetime import datetime
    from src.db.modelos import Usuario, Livro, Emprestimo
    from sqlalchemy import select

    DATA_DIR = Path(__file__).parent.parent / "data"

    # --- Usuários ---
    usuarios_file = DATA_DIR / "usuarios.json"
    if usuarios_file.exists():
        with open(usuarios_file, encoding="utf-8") as f:
            for u in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Usuario).where(Usuario.email == u["email"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]  # descompacta Row
                else:  # SQLAlchemy
                    existente = sessao.query(Usuario).filter_by(email=u["email"]).first()
                
                if not existente:
                    usuario = Usuario(
                        nome=u["nome"],
                        email=u["email"],
                        possui_multa_aberta=u.get("possui_multa_aberta", False),
                        qtd_emprestimo=u.get("qtd_emprestimo", 0)
                    )
                    sessao.add(usuario)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    usuario = existente
                # cria mapeamento do ID original para o ID real no banco
                u["_db_id"] = usuario.id

    # --- Livros ---
    livros_file = DATA_DIR / "livros.json"
    if livros_file.exists():
        with open(livros_file, encoding="utf-8") as f:
            for l in json.load(f):
                if hasattr(sessao, 'exec'):  # SQLModel
                    existente = sessao.exec(select(Livro).where(Livro.isbn == l["isbn"])).first()
                    if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                        existente = existente[0]
                else:  # SQLAlchemy
                    existente = sessao.query(Livro).filter_by(isbn=l["isbn"]).first()
                
                if not existente:
                    livro = Livro(
                        titulo=l["titulo"],
                        isbn=l["isbn"],
                        disponivel=l.get("disponivel", True)
                    )
                    sessao.add(livro)
                    sessao.commit()  # commit imediato para gerar ID
                else:
                    livro = existente
                # mapeia ID do JSON para o real
                l["_db_id"] = livro.id

    # --- Empréstimos ---
    emprestimos_file = DATA_DIR / "emprestimo.json"
    if emprestimos_file.exists():
        with open(emprestimos_file, encoding="utf-8") as f:
            for e in json.load(f):
                # busca usuário e livro pelo ID real
                usuario_id = e.get("usuario_id")
                livro_id = e.get("livro_id")
                
                if hasattr(sessao, 'exec'):  # SQLModel
                    usuario = sessao.exec(select(Usuario).where(Usuario.id == usuario_id)).first()
                    livro = sessao.exec(select(Livro).where(Livro.id == livro_id)).first()
                    if isinstance(usuario, tuple) or hasattr(usuario, "_mapping"):
                        usuario = usuario[0]
                    if isinstance(livro, tuple) or hasattr(livro, "_mapping"):
                        livro = livro[0]
                else:
                    usuario = sessao.query(Usuario).filter_by(id=usuario_id).first()
                    livro = sessao.query(Livro).filter_by(id=livro_id).first()
                
                if usuario and livro:
                    data_emprestimo = datetime.fromisoformat(e["data_emprestimo"]).date()
                    data_devolucao_prevista = datetime.fromisoformat(e["data_devolucao_prevista"]).date()
                    data_devolucao_real = datetime.fromisoformat(e["data_devolucao_real"]).date() \
                        if e.get("data_devolucao_real") else None

                    # verifica se já existe um empréstimo igual
                    if hasattr(sessao, 'exec'):
                        existente = sessao.exec(
                            select(Emprestimo).where(
                                Emprestimo.usuario_id == usuario.id,
                                Emprestimo.livro_id == livro.id,
                                Emprestimo.data_emprestimo == data_emprestimo
                            )
                        ).first()
                        if isinstance(existente, tuple) or hasattr(existente, "_mapping"):
                            existente = existente[0]
                    else:
                        existente = sessao.query(Emprestimo).filter_by(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo
                        ).first()

                    if not existente:
                        emprestimo = Emprestimo(
                            usuario_id=usuario.id,
                            livro_id=livro.id,
                            data_emprestimo=data_emprestimo,
                            data_devolucao_prevista=data_devolucao_prevista,
                            data_devolucao_real=data_devolucao_real,
                            dias_atraso=e.get("dias_atraso", 0),
                            valor_multa=e.get("valor_multa", 0)
                        )
                        sessao.add(None)
        sessao.commit()

x_carregar_dados_json__mutmut_mutants : ClassVar[MutantDict] = {
'x_carregar_dados_json__mutmut_1': x_carregar_dados_json__mutmut_1, 
    'x_carregar_dados_json__mutmut_2': x_carregar_dados_json__mutmut_2, 
    'x_carregar_dados_json__mutmut_3': x_carregar_dados_json__mutmut_3, 
    'x_carregar_dados_json__mutmut_4': x_carregar_dados_json__mutmut_4, 
    'x_carregar_dados_json__mutmut_5': x_carregar_dados_json__mutmut_5, 
    'x_carregar_dados_json__mutmut_6': x_carregar_dados_json__mutmut_6, 
    'x_carregar_dados_json__mutmut_7': x_carregar_dados_json__mutmut_7, 
    'x_carregar_dados_json__mutmut_8': x_carregar_dados_json__mutmut_8, 
    'x_carregar_dados_json__mutmut_9': x_carregar_dados_json__mutmut_9, 
    'x_carregar_dados_json__mutmut_10': x_carregar_dados_json__mutmut_10, 
    'x_carregar_dados_json__mutmut_11': x_carregar_dados_json__mutmut_11, 
    'x_carregar_dados_json__mutmut_12': x_carregar_dados_json__mutmut_12, 
    'x_carregar_dados_json__mutmut_13': x_carregar_dados_json__mutmut_13, 
    'x_carregar_dados_json__mutmut_14': x_carregar_dados_json__mutmut_14, 
    'x_carregar_dados_json__mutmut_15': x_carregar_dados_json__mutmut_15, 
    'x_carregar_dados_json__mutmut_16': x_carregar_dados_json__mutmut_16, 
    'x_carregar_dados_json__mutmut_17': x_carregar_dados_json__mutmut_17, 
    'x_carregar_dados_json__mutmut_18': x_carregar_dados_json__mutmut_18, 
    'x_carregar_dados_json__mutmut_19': x_carregar_dados_json__mutmut_19, 
    'x_carregar_dados_json__mutmut_20': x_carregar_dados_json__mutmut_20, 
    'x_carregar_dados_json__mutmut_21': x_carregar_dados_json__mutmut_21, 
    'x_carregar_dados_json__mutmut_22': x_carregar_dados_json__mutmut_22, 
    'x_carregar_dados_json__mutmut_23': x_carregar_dados_json__mutmut_23, 
    'x_carregar_dados_json__mutmut_24': x_carregar_dados_json__mutmut_24, 
    'x_carregar_dados_json__mutmut_25': x_carregar_dados_json__mutmut_25, 
    'x_carregar_dados_json__mutmut_26': x_carregar_dados_json__mutmut_26, 
    'x_carregar_dados_json__mutmut_27': x_carregar_dados_json__mutmut_27, 
    'x_carregar_dados_json__mutmut_28': x_carregar_dados_json__mutmut_28, 
    'x_carregar_dados_json__mutmut_29': x_carregar_dados_json__mutmut_29, 
    'x_carregar_dados_json__mutmut_30': x_carregar_dados_json__mutmut_30, 
    'x_carregar_dados_json__mutmut_31': x_carregar_dados_json__mutmut_31, 
    'x_carregar_dados_json__mutmut_32': x_carregar_dados_json__mutmut_32, 
    'x_carregar_dados_json__mutmut_33': x_carregar_dados_json__mutmut_33, 
    'x_carregar_dados_json__mutmut_34': x_carregar_dados_json__mutmut_34, 
    'x_carregar_dados_json__mutmut_35': x_carregar_dados_json__mutmut_35, 
    'x_carregar_dados_json__mutmut_36': x_carregar_dados_json__mutmut_36, 
    'x_carregar_dados_json__mutmut_37': x_carregar_dados_json__mutmut_37, 
    'x_carregar_dados_json__mutmut_38': x_carregar_dados_json__mutmut_38, 
    'x_carregar_dados_json__mutmut_39': x_carregar_dados_json__mutmut_39, 
    'x_carregar_dados_json__mutmut_40': x_carregar_dados_json__mutmut_40, 
    'x_carregar_dados_json__mutmut_41': x_carregar_dados_json__mutmut_41, 
    'x_carregar_dados_json__mutmut_42': x_carregar_dados_json__mutmut_42, 
    'x_carregar_dados_json__mutmut_43': x_carregar_dados_json__mutmut_43, 
    'x_carregar_dados_json__mutmut_44': x_carregar_dados_json__mutmut_44, 
    'x_carregar_dados_json__mutmut_45': x_carregar_dados_json__mutmut_45, 
    'x_carregar_dados_json__mutmut_46': x_carregar_dados_json__mutmut_46, 
    'x_carregar_dados_json__mutmut_47': x_carregar_dados_json__mutmut_47, 
    'x_carregar_dados_json__mutmut_48': x_carregar_dados_json__mutmut_48, 
    'x_carregar_dados_json__mutmut_49': x_carregar_dados_json__mutmut_49, 
    'x_carregar_dados_json__mutmut_50': x_carregar_dados_json__mutmut_50, 
    'x_carregar_dados_json__mutmut_51': x_carregar_dados_json__mutmut_51, 
    'x_carregar_dados_json__mutmut_52': x_carregar_dados_json__mutmut_52, 
    'x_carregar_dados_json__mutmut_53': x_carregar_dados_json__mutmut_53, 
    'x_carregar_dados_json__mutmut_54': x_carregar_dados_json__mutmut_54, 
    'x_carregar_dados_json__mutmut_55': x_carregar_dados_json__mutmut_55, 
    'x_carregar_dados_json__mutmut_56': x_carregar_dados_json__mutmut_56, 
    'x_carregar_dados_json__mutmut_57': x_carregar_dados_json__mutmut_57, 
    'x_carregar_dados_json__mutmut_58': x_carregar_dados_json__mutmut_58, 
    'x_carregar_dados_json__mutmut_59': x_carregar_dados_json__mutmut_59, 
    'x_carregar_dados_json__mutmut_60': x_carregar_dados_json__mutmut_60, 
    'x_carregar_dados_json__mutmut_61': x_carregar_dados_json__mutmut_61, 
    'x_carregar_dados_json__mutmut_62': x_carregar_dados_json__mutmut_62, 
    'x_carregar_dados_json__mutmut_63': x_carregar_dados_json__mutmut_63, 
    'x_carregar_dados_json__mutmut_64': x_carregar_dados_json__mutmut_64, 
    'x_carregar_dados_json__mutmut_65': x_carregar_dados_json__mutmut_65, 
    'x_carregar_dados_json__mutmut_66': x_carregar_dados_json__mutmut_66, 
    'x_carregar_dados_json__mutmut_67': x_carregar_dados_json__mutmut_67, 
    'x_carregar_dados_json__mutmut_68': x_carregar_dados_json__mutmut_68, 
    'x_carregar_dados_json__mutmut_69': x_carregar_dados_json__mutmut_69, 
    'x_carregar_dados_json__mutmut_70': x_carregar_dados_json__mutmut_70, 
    'x_carregar_dados_json__mutmut_71': x_carregar_dados_json__mutmut_71, 
    'x_carregar_dados_json__mutmut_72': x_carregar_dados_json__mutmut_72, 
    'x_carregar_dados_json__mutmut_73': x_carregar_dados_json__mutmut_73, 
    'x_carregar_dados_json__mutmut_74': x_carregar_dados_json__mutmut_74, 
    'x_carregar_dados_json__mutmut_75': x_carregar_dados_json__mutmut_75, 
    'x_carregar_dados_json__mutmut_76': x_carregar_dados_json__mutmut_76, 
    'x_carregar_dados_json__mutmut_77': x_carregar_dados_json__mutmut_77, 
    'x_carregar_dados_json__mutmut_78': x_carregar_dados_json__mutmut_78, 
    'x_carregar_dados_json__mutmut_79': x_carregar_dados_json__mutmut_79, 
    'x_carregar_dados_json__mutmut_80': x_carregar_dados_json__mutmut_80, 
    'x_carregar_dados_json__mutmut_81': x_carregar_dados_json__mutmut_81, 
    'x_carregar_dados_json__mutmut_82': x_carregar_dados_json__mutmut_82, 
    'x_carregar_dados_json__mutmut_83': x_carregar_dados_json__mutmut_83, 
    'x_carregar_dados_json__mutmut_84': x_carregar_dados_json__mutmut_84, 
    'x_carregar_dados_json__mutmut_85': x_carregar_dados_json__mutmut_85, 
    'x_carregar_dados_json__mutmut_86': x_carregar_dados_json__mutmut_86, 
    'x_carregar_dados_json__mutmut_87': x_carregar_dados_json__mutmut_87, 
    'x_carregar_dados_json__mutmut_88': x_carregar_dados_json__mutmut_88, 
    'x_carregar_dados_json__mutmut_89': x_carregar_dados_json__mutmut_89, 
    'x_carregar_dados_json__mutmut_90': x_carregar_dados_json__mutmut_90, 
    'x_carregar_dados_json__mutmut_91': x_carregar_dados_json__mutmut_91, 
    'x_carregar_dados_json__mutmut_92': x_carregar_dados_json__mutmut_92, 
    'x_carregar_dados_json__mutmut_93': x_carregar_dados_json__mutmut_93, 
    'x_carregar_dados_json__mutmut_94': x_carregar_dados_json__mutmut_94, 
    'x_carregar_dados_json__mutmut_95': x_carregar_dados_json__mutmut_95, 
    'x_carregar_dados_json__mutmut_96': x_carregar_dados_json__mutmut_96, 
    'x_carregar_dados_json__mutmut_97': x_carregar_dados_json__mutmut_97, 
    'x_carregar_dados_json__mutmut_98': x_carregar_dados_json__mutmut_98, 
    'x_carregar_dados_json__mutmut_99': x_carregar_dados_json__mutmut_99, 
    'x_carregar_dados_json__mutmut_100': x_carregar_dados_json__mutmut_100, 
    'x_carregar_dados_json__mutmut_101': x_carregar_dados_json__mutmut_101, 
    'x_carregar_dados_json__mutmut_102': x_carregar_dados_json__mutmut_102, 
    'x_carregar_dados_json__mutmut_103': x_carregar_dados_json__mutmut_103, 
    'x_carregar_dados_json__mutmut_104': x_carregar_dados_json__mutmut_104, 
    'x_carregar_dados_json__mutmut_105': x_carregar_dados_json__mutmut_105, 
    'x_carregar_dados_json__mutmut_106': x_carregar_dados_json__mutmut_106, 
    'x_carregar_dados_json__mutmut_107': x_carregar_dados_json__mutmut_107, 
    'x_carregar_dados_json__mutmut_108': x_carregar_dados_json__mutmut_108, 
    'x_carregar_dados_json__mutmut_109': x_carregar_dados_json__mutmut_109, 
    'x_carregar_dados_json__mutmut_110': x_carregar_dados_json__mutmut_110, 
    'x_carregar_dados_json__mutmut_111': x_carregar_dados_json__mutmut_111, 
    'x_carregar_dados_json__mutmut_112': x_carregar_dados_json__mutmut_112, 
    'x_carregar_dados_json__mutmut_113': x_carregar_dados_json__mutmut_113, 
    'x_carregar_dados_json__mutmut_114': x_carregar_dados_json__mutmut_114, 
    'x_carregar_dados_json__mutmut_115': x_carregar_dados_json__mutmut_115, 
    'x_carregar_dados_json__mutmut_116': x_carregar_dados_json__mutmut_116, 
    'x_carregar_dados_json__mutmut_117': x_carregar_dados_json__mutmut_117, 
    'x_carregar_dados_json__mutmut_118': x_carregar_dados_json__mutmut_118, 
    'x_carregar_dados_json__mutmut_119': x_carregar_dados_json__mutmut_119, 
    'x_carregar_dados_json__mutmut_120': x_carregar_dados_json__mutmut_120, 
    'x_carregar_dados_json__mutmut_121': x_carregar_dados_json__mutmut_121, 
    'x_carregar_dados_json__mutmut_122': x_carregar_dados_json__mutmut_122, 
    'x_carregar_dados_json__mutmut_123': x_carregar_dados_json__mutmut_123, 
    'x_carregar_dados_json__mutmut_124': x_carregar_dados_json__mutmut_124, 
    'x_carregar_dados_json__mutmut_125': x_carregar_dados_json__mutmut_125, 
    'x_carregar_dados_json__mutmut_126': x_carregar_dados_json__mutmut_126, 
    'x_carregar_dados_json__mutmut_127': x_carregar_dados_json__mutmut_127, 
    'x_carregar_dados_json__mutmut_128': x_carregar_dados_json__mutmut_128, 
    'x_carregar_dados_json__mutmut_129': x_carregar_dados_json__mutmut_129, 
    'x_carregar_dados_json__mutmut_130': x_carregar_dados_json__mutmut_130, 
    'x_carregar_dados_json__mutmut_131': x_carregar_dados_json__mutmut_131, 
    'x_carregar_dados_json__mutmut_132': x_carregar_dados_json__mutmut_132, 
    'x_carregar_dados_json__mutmut_133': x_carregar_dados_json__mutmut_133, 
    'x_carregar_dados_json__mutmut_134': x_carregar_dados_json__mutmut_134, 
    'x_carregar_dados_json__mutmut_135': x_carregar_dados_json__mutmut_135, 
    'x_carregar_dados_json__mutmut_136': x_carregar_dados_json__mutmut_136, 
    'x_carregar_dados_json__mutmut_137': x_carregar_dados_json__mutmut_137, 
    'x_carregar_dados_json__mutmut_138': x_carregar_dados_json__mutmut_138, 
    'x_carregar_dados_json__mutmut_139': x_carregar_dados_json__mutmut_139, 
    'x_carregar_dados_json__mutmut_140': x_carregar_dados_json__mutmut_140, 
    'x_carregar_dados_json__mutmut_141': x_carregar_dados_json__mutmut_141, 
    'x_carregar_dados_json__mutmut_142': x_carregar_dados_json__mutmut_142, 
    'x_carregar_dados_json__mutmut_143': x_carregar_dados_json__mutmut_143, 
    'x_carregar_dados_json__mutmut_144': x_carregar_dados_json__mutmut_144, 
    'x_carregar_dados_json__mutmut_145': x_carregar_dados_json__mutmut_145, 
    'x_carregar_dados_json__mutmut_146': x_carregar_dados_json__mutmut_146, 
    'x_carregar_dados_json__mutmut_147': x_carregar_dados_json__mutmut_147, 
    'x_carregar_dados_json__mutmut_148': x_carregar_dados_json__mutmut_148, 
    'x_carregar_dados_json__mutmut_149': x_carregar_dados_json__mutmut_149, 
    'x_carregar_dados_json__mutmut_150': x_carregar_dados_json__mutmut_150, 
    'x_carregar_dados_json__mutmut_151': x_carregar_dados_json__mutmut_151, 
    'x_carregar_dados_json__mutmut_152': x_carregar_dados_json__mutmut_152, 
    'x_carregar_dados_json__mutmut_153': x_carregar_dados_json__mutmut_153, 
    'x_carregar_dados_json__mutmut_154': x_carregar_dados_json__mutmut_154, 
    'x_carregar_dados_json__mutmut_155': x_carregar_dados_json__mutmut_155, 
    'x_carregar_dados_json__mutmut_156': x_carregar_dados_json__mutmut_156, 
    'x_carregar_dados_json__mutmut_157': x_carregar_dados_json__mutmut_157, 
    'x_carregar_dados_json__mutmut_158': x_carregar_dados_json__mutmut_158, 
    'x_carregar_dados_json__mutmut_159': x_carregar_dados_json__mutmut_159, 
    'x_carregar_dados_json__mutmut_160': x_carregar_dados_json__mutmut_160, 
    'x_carregar_dados_json__mutmut_161': x_carregar_dados_json__mutmut_161, 
    'x_carregar_dados_json__mutmut_162': x_carregar_dados_json__mutmut_162, 
    'x_carregar_dados_json__mutmut_163': x_carregar_dados_json__mutmut_163, 
    'x_carregar_dados_json__mutmut_164': x_carregar_dados_json__mutmut_164, 
    'x_carregar_dados_json__mutmut_165': x_carregar_dados_json__mutmut_165, 
    'x_carregar_dados_json__mutmut_166': x_carregar_dados_json__mutmut_166, 
    'x_carregar_dados_json__mutmut_167': x_carregar_dados_json__mutmut_167, 
    'x_carregar_dados_json__mutmut_168': x_carregar_dados_json__mutmut_168, 
    'x_carregar_dados_json__mutmut_169': x_carregar_dados_json__mutmut_169, 
    'x_carregar_dados_json__mutmut_170': x_carregar_dados_json__mutmut_170, 
    'x_carregar_dados_json__mutmut_171': x_carregar_dados_json__mutmut_171, 
    'x_carregar_dados_json__mutmut_172': x_carregar_dados_json__mutmut_172, 
    'x_carregar_dados_json__mutmut_173': x_carregar_dados_json__mutmut_173, 
    'x_carregar_dados_json__mutmut_174': x_carregar_dados_json__mutmut_174, 
    'x_carregar_dados_json__mutmut_175': x_carregar_dados_json__mutmut_175, 
    'x_carregar_dados_json__mutmut_176': x_carregar_dados_json__mutmut_176, 
    'x_carregar_dados_json__mutmut_177': x_carregar_dados_json__mutmut_177, 
    'x_carregar_dados_json__mutmut_178': x_carregar_dados_json__mutmut_178, 
    'x_carregar_dados_json__mutmut_179': x_carregar_dados_json__mutmut_179, 
    'x_carregar_dados_json__mutmut_180': x_carregar_dados_json__mutmut_180, 
    'x_carregar_dados_json__mutmut_181': x_carregar_dados_json__mutmut_181, 
    'x_carregar_dados_json__mutmut_182': x_carregar_dados_json__mutmut_182, 
    'x_carregar_dados_json__mutmut_183': x_carregar_dados_json__mutmut_183, 
    'x_carregar_dados_json__mutmut_184': x_carregar_dados_json__mutmut_184, 
    'x_carregar_dados_json__mutmut_185': x_carregar_dados_json__mutmut_185, 
    'x_carregar_dados_json__mutmut_186': x_carregar_dados_json__mutmut_186, 
    'x_carregar_dados_json__mutmut_187': x_carregar_dados_json__mutmut_187, 
    'x_carregar_dados_json__mutmut_188': x_carregar_dados_json__mutmut_188, 
    'x_carregar_dados_json__mutmut_189': x_carregar_dados_json__mutmut_189, 
    'x_carregar_dados_json__mutmut_190': x_carregar_dados_json__mutmut_190, 
    'x_carregar_dados_json__mutmut_191': x_carregar_dados_json__mutmut_191, 
    'x_carregar_dados_json__mutmut_192': x_carregar_dados_json__mutmut_192, 
    'x_carregar_dados_json__mutmut_193': x_carregar_dados_json__mutmut_193, 
    'x_carregar_dados_json__mutmut_194': x_carregar_dados_json__mutmut_194, 
    'x_carregar_dados_json__mutmut_195': x_carregar_dados_json__mutmut_195, 
    'x_carregar_dados_json__mutmut_196': x_carregar_dados_json__mutmut_196, 
    'x_carregar_dados_json__mutmut_197': x_carregar_dados_json__mutmut_197, 
    'x_carregar_dados_json__mutmut_198': x_carregar_dados_json__mutmut_198, 
    'x_carregar_dados_json__mutmut_199': x_carregar_dados_json__mutmut_199, 
    'x_carregar_dados_json__mutmut_200': x_carregar_dados_json__mutmut_200, 
    'x_carregar_dados_json__mutmut_201': x_carregar_dados_json__mutmut_201, 
    'x_carregar_dados_json__mutmut_202': x_carregar_dados_json__mutmut_202, 
    'x_carregar_dados_json__mutmut_203': x_carregar_dados_json__mutmut_203, 
    'x_carregar_dados_json__mutmut_204': x_carregar_dados_json__mutmut_204, 
    'x_carregar_dados_json__mutmut_205': x_carregar_dados_json__mutmut_205, 
    'x_carregar_dados_json__mutmut_206': x_carregar_dados_json__mutmut_206, 
    'x_carregar_dados_json__mutmut_207': x_carregar_dados_json__mutmut_207, 
    'x_carregar_dados_json__mutmut_208': x_carregar_dados_json__mutmut_208, 
    'x_carregar_dados_json__mutmut_209': x_carregar_dados_json__mutmut_209, 
    'x_carregar_dados_json__mutmut_210': x_carregar_dados_json__mutmut_210, 
    'x_carregar_dados_json__mutmut_211': x_carregar_dados_json__mutmut_211, 
    'x_carregar_dados_json__mutmut_212': x_carregar_dados_json__mutmut_212, 
    'x_carregar_dados_json__mutmut_213': x_carregar_dados_json__mutmut_213, 
    'x_carregar_dados_json__mutmut_214': x_carregar_dados_json__mutmut_214, 
    'x_carregar_dados_json__mutmut_215': x_carregar_dados_json__mutmut_215, 
    'x_carregar_dados_json__mutmut_216': x_carregar_dados_json__mutmut_216, 
    'x_carregar_dados_json__mutmut_217': x_carregar_dados_json__mutmut_217, 
    'x_carregar_dados_json__mutmut_218': x_carregar_dados_json__mutmut_218, 
    'x_carregar_dados_json__mutmut_219': x_carregar_dados_json__mutmut_219, 
    'x_carregar_dados_json__mutmut_220': x_carregar_dados_json__mutmut_220, 
    'x_carregar_dados_json__mutmut_221': x_carregar_dados_json__mutmut_221, 
    'x_carregar_dados_json__mutmut_222': x_carregar_dados_json__mutmut_222, 
    'x_carregar_dados_json__mutmut_223': x_carregar_dados_json__mutmut_223, 
    'x_carregar_dados_json__mutmut_224': x_carregar_dados_json__mutmut_224, 
    'x_carregar_dados_json__mutmut_225': x_carregar_dados_json__mutmut_225, 
    'x_carregar_dados_json__mutmut_226': x_carregar_dados_json__mutmut_226, 
    'x_carregar_dados_json__mutmut_227': x_carregar_dados_json__mutmut_227, 
    'x_carregar_dados_json__mutmut_228': x_carregar_dados_json__mutmut_228, 
    'x_carregar_dados_json__mutmut_229': x_carregar_dados_json__mutmut_229, 
    'x_carregar_dados_json__mutmut_230': x_carregar_dados_json__mutmut_230, 
    'x_carregar_dados_json__mutmut_231': x_carregar_dados_json__mutmut_231, 
    'x_carregar_dados_json__mutmut_232': x_carregar_dados_json__mutmut_232, 
    'x_carregar_dados_json__mutmut_233': x_carregar_dados_json__mutmut_233, 
    'x_carregar_dados_json__mutmut_234': x_carregar_dados_json__mutmut_234, 
    'x_carregar_dados_json__mutmut_235': x_carregar_dados_json__mutmut_235, 
    'x_carregar_dados_json__mutmut_236': x_carregar_dados_json__mutmut_236, 
    'x_carregar_dados_json__mutmut_237': x_carregar_dados_json__mutmut_237, 
    'x_carregar_dados_json__mutmut_238': x_carregar_dados_json__mutmut_238, 
    'x_carregar_dados_json__mutmut_239': x_carregar_dados_json__mutmut_239, 
    'x_carregar_dados_json__mutmut_240': x_carregar_dados_json__mutmut_240, 
    'x_carregar_dados_json__mutmut_241': x_carregar_dados_json__mutmut_241, 
    'x_carregar_dados_json__mutmut_242': x_carregar_dados_json__mutmut_242, 
    'x_carregar_dados_json__mutmut_243': x_carregar_dados_json__mutmut_243, 
    'x_carregar_dados_json__mutmut_244': x_carregar_dados_json__mutmut_244, 
    'x_carregar_dados_json__mutmut_245': x_carregar_dados_json__mutmut_245, 
    'x_carregar_dados_json__mutmut_246': x_carregar_dados_json__mutmut_246, 
    'x_carregar_dados_json__mutmut_247': x_carregar_dados_json__mutmut_247, 
    'x_carregar_dados_json__mutmut_248': x_carregar_dados_json__mutmut_248, 
    'x_carregar_dados_json__mutmut_249': x_carregar_dados_json__mutmut_249, 
    'x_carregar_dados_json__mutmut_250': x_carregar_dados_json__mutmut_250, 
    'x_carregar_dados_json__mutmut_251': x_carregar_dados_json__mutmut_251, 
    'x_carregar_dados_json__mutmut_252': x_carregar_dados_json__mutmut_252, 
    'x_carregar_dados_json__mutmut_253': x_carregar_dados_json__mutmut_253, 
    'x_carregar_dados_json__mutmut_254': x_carregar_dados_json__mutmut_254, 
    'x_carregar_dados_json__mutmut_255': x_carregar_dados_json__mutmut_255, 
    'x_carregar_dados_json__mutmut_256': x_carregar_dados_json__mutmut_256, 
    'x_carregar_dados_json__mutmut_257': x_carregar_dados_json__mutmut_257, 
    'x_carregar_dados_json__mutmut_258': x_carregar_dados_json__mutmut_258, 
    'x_carregar_dados_json__mutmut_259': x_carregar_dados_json__mutmut_259, 
    'x_carregar_dados_json__mutmut_260': x_carregar_dados_json__mutmut_260, 
    'x_carregar_dados_json__mutmut_261': x_carregar_dados_json__mutmut_261, 
    'x_carregar_dados_json__mutmut_262': x_carregar_dados_json__mutmut_262, 
    'x_carregar_dados_json__mutmut_263': x_carregar_dados_json__mutmut_263, 
    'x_carregar_dados_json__mutmut_264': x_carregar_dados_json__mutmut_264, 
    'x_carregar_dados_json__mutmut_265': x_carregar_dados_json__mutmut_265, 
    'x_carregar_dados_json__mutmut_266': x_carregar_dados_json__mutmut_266, 
    'x_carregar_dados_json__mutmut_267': x_carregar_dados_json__mutmut_267, 
    'x_carregar_dados_json__mutmut_268': x_carregar_dados_json__mutmut_268, 
    'x_carregar_dados_json__mutmut_269': x_carregar_dados_json__mutmut_269, 
    'x_carregar_dados_json__mutmut_270': x_carregar_dados_json__mutmut_270, 
    'x_carregar_dados_json__mutmut_271': x_carregar_dados_json__mutmut_271, 
    'x_carregar_dados_json__mutmut_272': x_carregar_dados_json__mutmut_272, 
    'x_carregar_dados_json__mutmut_273': x_carregar_dados_json__mutmut_273, 
    'x_carregar_dados_json__mutmut_274': x_carregar_dados_json__mutmut_274, 
    'x_carregar_dados_json__mutmut_275': x_carregar_dados_json__mutmut_275, 
    'x_carregar_dados_json__mutmut_276': x_carregar_dados_json__mutmut_276, 
    'x_carregar_dados_json__mutmut_277': x_carregar_dados_json__mutmut_277, 
    'x_carregar_dados_json__mutmut_278': x_carregar_dados_json__mutmut_278, 
    'x_carregar_dados_json__mutmut_279': x_carregar_dados_json__mutmut_279
}

def carregar_dados_json(*args, **kwargs):
    result = _mutmut_trampoline(x_carregar_dados_json__mutmut_orig, x_carregar_dados_json__mutmut_mutants, args, kwargs)
    return result 

carregar_dados_json.__signature__ = _mutmut_signature(x_carregar_dados_json__mutmut_orig)
x_carregar_dados_json__mutmut_orig.__name__ = 'x_carregar_dados_json'


@router.get("/forcar-carregar-json")
def forcar_carregar_json(request: Request):
    from src.server.web_ui import carregar_dados_json
    from src.db.conexao import obter_sessao

    sessao = next(obter_sessao())
    carregar_dados_json(sessao)
    return {"status": "✅ Dados JSON carregados no banco SQLite"}
